<html>

<script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>

<div style="float:left;">
	<textarea id="mySource"></textarea>
</div>
<div id="myConsole">
</div>

<div style="width:100%;height:40px;float:left;">
	<button id="btn-submit">Submit</button>
</div>

<style>
#mySource{
	width:600px;
	height:1500px;
	overflow: auto;
}

#myConsole{
	border:1px solid #ccc;
	width:400px; 
	height:1500px; 
	overflow: auto;
	float:left;
	margin-left:30px;
}

</style>

<script>

    $(document).ready(function () {
		$('#btn-submit').click(function(){
			var src = $('#mySource').val();
			process(src);
		});
		
		var _inComment = false;
		
		function processComment(){
		for(var i=0; i<nLines; i++){
				if(!inComment){
					var ret = processComment(lines[i]);
					if(ret.startComment){
						inComment = true;
					}else{
						var line = ret.remain;
						var f = getPrivateFunc(line);
						var m = getPublicFunc(line);
						
						if(f){
							nPrivFuncs += f.length;
							
							for(var j=0; j<f.length; j++){
								funcs.push( getPrivateFuncName(f[j]));
							}
						}
						
						if(m){
							nMethods += m.length;
							for(var j=0; j<m.length; j++){
								methods.push(getPublicFuncName(m[j]));
							}
						}
					}
				}else{
					var j = lines[i].indexOf('*/');
					if(j!=-1){
						lines[i] = lines[i].substring(j + 2, s.length);
						// Fix me !!!
					}else{
						lines[i] == '';
					}
				}
			}
		}
		
		function process(src){
			var lines = getLines(src);
			var nLines = lines.length;
			var nPrivFuncs = 0;
			var funcs = [];
			var methods = [];
			var nMethods = 0;
			var inComment = false;
			
			var i = 0;
			var done = false;
			
			while( i < nLines && !done){
				var ret = rmLineBlockComments(lines[i]);
				
				while(ret.inBlock){
					ret = rmBlockComment(i, lines, ret.inBlock);
					if(ret){
						if(ret.hasOwnProperty('lineEnd') && i != -1){
							i = ret.endLine;
						}else{
							done = true;
						}
					}else{
						// do nothing
					}
				}
				i++;
				console.log(ret);
			}
			
			/*
			$('#myConsole').empty();

			
			for(var i=0; i<funcs.length; i++){
				$('#myConsole').prepend('<div>' + funcs[i] + '</div>');
			}
						
			$('#myConsole').prepend('<div>Private Functions:' + nPrivFuncs + '</div>');
			for(var i=0; i<methods.length; i++){
				$('#myConsole').prepend('<div>' + methods[i] + '</div>');
			}
			$('#myConsole').prepend('<div>Public Functions:' + nMethods + '</div>');
			$('#myConsole').prepend('<div>Lines:' + nLines + '</div>');
			*/
		}
		
		function getLines(s){
			return s.split('\n');
		}
		
		function ltrim(s){
			return s.replace(/^\s+/,"");
		}

		function rmBlockComment(start, lines, inBlock) {
			var i = start;

			while (inBlock) {
				var line = lines[i];
				var k = line.indexOf('*/');
				if (k != -1) {
					lines[i] = line.substring(k + 2, line.length);
					inBlock = false;
					var ret = rmLineBlockComments(lines[i]);
					lines[i] = ret.remain;
					ret['lineEnd'] = i;
					inBlock = ret.inBlock;
				} else {
					lines[i] = '';
					i++;
					if (i >= lines.length - 1) {
						return { 'done': true, 'remain': s, 'inBlock': false, 'lineEnd': lines.length - 1 };
					}
				}
			}
		}

		function rmLineBlockComments(line) {
			var ret = findLineBlockComment(line);
			while (!ret.done) {
				ret = findLineBlockComment(ret.remain);
			}
			return ret;
		}

		function findLineBlockComment(s) {
			var len = s.length;
			var a = [];
			var i = s.indexOf('/');

			if (i != -1) {
				if (i + 1 < len) {
					if (s[i + 1] == '/') {
						return { done: true, remain: s.substring(0, i), 'inBlock': false };
					} else if (s[i + 1] == '*') {
						var j = s.indexOf('*/');
						if (j != -1) {
							return ({ 'done': false, 'remain': s.substring(0, i) + s.substring(j + 2, len), 'inBlock': false });
						} else {
							return { 'done': true, 'remain': s.substring(0, i), 'inBlock': true };
						}
					} else {
						var head = s.substring(0, i + 2);
						var tail = s.substring(i + 2, len);
						var ret = findLineBlockComment(tail);
						ret.remain = head + ret.remain;
						return ret;
					}
				} else {
					return { 'done': true, 'remain': s, 'inBlock': false };
				}
			} else {
				return { 'done': true, 'remain': s, 'inBlock': false };
			}
		}
		
		function processComment(line){
			var i = line.indexOf('//');
			var s = line;
			if(i!=-1){
				s = line.substring(0, i);
			}
			
			var r = findComment(s);
			var remain = s;
			while(r.found && r.end != -1){
				remain = s.substring(0, r.start) + s.substring(r.end + 2, s.length);
				r = findComment(remain);
			}
			
			return { 'remain': remain,
				'comentStart': r.found && r.end == -1,
				'start':r.start
				};
		}
		
		function findComment(s){
			var i = s.indexOf('/*');
			if(i!=-1){
				var sub = s.substring(i, s.length);
				var j = sub.indexOf('*/');
				if(j!=-1){
					return {'found':true, 'start':i, 'end':j};
				}else{
					return {'found':true, 'start':i, 'end':-1};
				}
			}else{
				return {'found':false, 'start':-1, 'end':-1};
			}
		}
		
		function isMultiCommentStart(line){
			var s = ltrim(line);
			if(s.length >= 2){
				return s[0]=='/' && s[1] == '*';
			}else{
				return false;
			}
		} 
		
		function isMultiCommentEnd(line){

		}
		
		function isSingleLineComment(line){
			var s = ltrim(line);
			if( s.length >=2 ){
				return s[0]=='/' && s[1] == '/';
			}else{
				return false;
			}
		}
		
		
		
		function getPrivateFunc(s){
			var m = s.match(/function[\s]+[$a-zA-Z_][a-zA-Z0-9_$]*/g);
			if(m){
				return m;
			}else{
				return null;
			}
		}
		
		function getPrivateFuncName(s){
			return s.replace(/function[\s]+/g, '');
		}
		
		function getPublicFunc(s){
			var m = s.match(/this.[$a-zA-Z_][a-zA-Z0-9_$]*[\s]+\=[\s]+function/g);
			if(m){
				return m;
			}else{
				return null;
			}
		}
		
		function getPublicFuncName(s){
			var a = s.split('=');
			if(a && a.length>0){
				return a[0].replace(/this\./g, '').replace(/[\s]+/g, '');
			}else{
				return null;
			}
		}
		
    });
    


</script>
</html>